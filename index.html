<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vlad.GG - Guide & AI Coach</title>
    <style>
        :root {
            --bg: #121212; --card: #1e1e1e; --text: #e0e0e0;
            --accent: #e84057; --green: #4caf50; --yellow: #ff9800; --red: #f44336;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; margin: 0; padding-bottom: 100px; }
        
        /* HEADER */
        header { display: flex; align-items: center; gap: 15px; margin-bottom: 30px; border-bottom: 2px solid var(--accent); padding-bottom: 20px; }
        header img { width: 70px; border-radius: 50%; border: 3px solid var(--accent); }
        h1 { margin: 0; font-size: 1.8rem; letter-spacing: 1px; }
        h1 span { color: var(--accent); }

        /* GRID SYSTEM */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 20px; }

        /* CARDS */
        .card { background: var(--card); border-radius: 12px; padding: 20px; border-left: 6px solid gray; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .card.Easy { border-left-color: var(--green); }
        .card.Medium { border-left-color: var(--yellow); }
        .card.Hard { border-left-color: var(--red); }

        .top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .champ-face { display: flex; align-items: center; gap: 12px; font-weight: bold; font-size: 1.3rem; }
        .champ-face img { width: 48px; height: 48px; border-radius: 8px; }

        .stats { display: flex; justify-content: space-between; font-size: 0.9rem; color: #888; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #333; }
        
        /* BUILD & RUNES SETUP */
        .setup-container { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
        .row-setup { display: flex; align-items: center; gap: 10px; }
        .label { font-size: 0.75rem; color: #666; width: 50px; text-transform: uppercase; }
        .icon-group { display: flex; gap: 5px; }
        .icon-group img { width: 34px; height: 34px; border-radius: 6px; border: 1px solid #444; background: #000; }
        .rune-main { border-color: var(--accent) !important; }

        .tips { background: #252525; padding: 12px; border-radius: 6px; font-size: 0.9rem; line-height: 1.5; color: #ccc; border-left: 2px solid #555; }
        .tips::before { content: "üí° "; font-weight: bold; color: #fff; }

        /* --- STYLE DU CHATBOT IA --- */
        .fab-btn {
            position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px;
            background: var(--accent); color: white; border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); display: flex; justify-content: center;
            align-items: center; font-size: 30px; cursor: pointer; border: none; z-index: 1000;
            transition: transform 0.2s;
        }
        .fab-btn:hover { transform: scale(1.1); }

        .chat-window {
            position: fixed; bottom: 90px; right: 20px; width: 350px; height: 500px;
            background: #1a1a1a; border: 1px solid #333; border-radius: 12px;
            display: none; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            z-index: 1000; overflow: hidden;
        }
        .chat-header { background: var(--accent); padding: 15px; font-weight: bold; display: flex; justify-content: space-between; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; font-size: 0.9rem; }
        .chat-input-area { padding: 10px; background: #222; display: flex; gap: 5px; border-top: 1px solid #333; }
        .chat-input { flex: 1; padding: 10px; border-radius: 20px; border: none; background: #333; color: white; outline: none; }
        .send-btn { background: var(--accent); border: none; width: 40px; height: 40px; border-radius: 50%; color: white; cursor: pointer; }
        
        .msg { padding: 10px; border-radius: 10px; max-width: 80%; line-height: 1.4; }
        .msg.user { background: #333; align-self: flex-end; color: #ddd; }
        .msg.bot { background: rgba(232, 64, 87, 0.2); align-self: flex-start; border: 1px solid var(--accent); color: #fff; }
        
        .api-key-screen { padding: 20px; text-align: center; display: flex; flex-direction: column; gap: 10px; justify-content: center; height: 100%; }
        .save-key-btn { background: var(--green); color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer; }
        .reset-key { color: #888; font-size: 0.8rem; text-decoration: underline; cursor: pointer; }
    </style>
</head>
<body>

    <header>
        <img src="https://ddragon.leagueoflegends.com/cdn/14.23.1/img/champion/Vladimir.png">
        <div>
            <h1>Vlad<span>.GG</span></h1>
            <small>Build: Concentration Lointaine > Rabadon > Riftmaker</small>
        </div>
    </header>

    <div id="app" class="grid">Chargement des donn√©es...</div>

    <button class="fab-btn" onclick="toggleChat()">ü©∏</button>

    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <span>Coach Vlad AI</span>
            <span style="cursor:pointer" onclick="toggleChat()">‚úñ</span>
        </div>
        <div id="apiKeyScreen" class="api-key-screen">
            <h3>Configuration IA</h3>
            <p style="font-size:0.8rem; color:#aaa;">Entre ta cl√© Google Gemini API (stock√©e dans ton navigateur uniquement).</p>
            <input type="password" id="apiKeyInput" placeholder="Cl√© API (AIza...)" class="chat-input" style="border-radius:5px;">
            <button class="save-key-btn" onclick="saveKey()">Activer le Coach</button>
            <small><a href="https://aistudio.google.com/app/apikey" target="_blank" style="color:var(--accent)">Obtenir une cl√© gratuite</a></small>
        </div>
        <div id="chatInterface" style="display:none; flex-direction:column; height:100%;">
            <div class="chat-body" id="chatBody">
                <div class="msg bot">Le sang coule... Que veux-tu savoir sur la voie du dessus ?</div>
            </div>
            <div class="chat-input-area">
                <span class="reset-key" onclick="resetKey()" title="Changer de cl√©">üîë</span>
                <input type="text" id="userMsg" class="chat-input" placeholder="Ex: Comment battre Darius ?" onkeypress="handleEnter(event)">
                <button class="send-btn" onclick="sendMessage()">‚û§</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. CHARGEMENT DES DONN√âES (JSON) ---
        // Utilisation de la derni√®re version et de liens stables pour les runes
        const DDRAGON_VER = "14.23.1";
        const CDN_BASE = `https://ddragon.leagueoflegends.com/cdn/${DDRAGON_VER}/img/`;
        // Liens "CommunityDragon" (plus stables pour les runes)
        const RUNE_IMGS = {
            "Phase": "https://raw.communitydragon.org/latest/plugins/rcp-be-lol-game-data/global/default/v1/perk-images/styles/sorcery/phaserush/phaserush.png",
            "Elec": "https://raw.communitydragon.org/latest/plugins/rcp-be-lol-game-data/global/default/v1/perk-images/styles/domination/electrocute/electrocute.png",
            "Aery": "https://raw.communitydragon.org/latest/plugins/rcp-be-lol-game-data/global/default/v1/perk-images/styles/sorcery/summonaery/summonaery.png",
            "Conq": "https://raw.communitydragon.org/latest/plugins/rcp-be-lol-game-data/global/default/v1/perk-images/styles/precision/conqueror/conqueror.png"
        };

        async function loadData() {
            try {
                const response = await fetch('data.json');
                const matchups = await response.json();
                const container = document.getElementById('app');
                container.innerHTML = '';

                matchups.forEach(m => {
                    let itemsHtml = m.build.map(id => `<img src="${CDN_BASE}item/${id}.png" title="ID: ${id}">`).join('');
                    // Correction des liens des sorts d'invocateur
                    let summonsHtml = m.summons.map(spell => `<img src="${CDN_BASE}spell/${spell}.png" title="${spell}">`).join('');
                    let runeUrl = RUNE_IMGS[m.runes] || RUNE_IMGS["Phase"];

                    const html = `
                        <div class="card ${m.difficulty}">
                            <div class="top-row">
                                <div class="champ-face">
                                    <img src="${CDN_BASE}champion/${m.id}.png">
                                    <span>${m.id}</span>
                                </div>
                                <span style="font-weight:bold; color:var(--${m.difficulty === 'Hard' ? 'red' : m.difficulty === 'Easy' ? 'green' : 'yellow'})">
                                    ${m.difficulty.toUpperCase()}
                                </span>
                            </div>
                            <div class="stats">
                                <span>Winrate: <span style="color:${m.winrate < 48 ? 'var(--red)' : 'var(--green)'}; font-weight:bold;">${m.winrate}%</span></span>
                            </div>
                            <div class="setup-container">
                                <div class="row-setup"><span class="label">Start</span><div class="icon-group"><img src="${runeUrl}" class="rune-main">${summonsHtml}</div></div>
                                <div class="row-setup"><span class="label">Core</span><div class="icon-group">${itemsHtml}</div></div>
                            </div>
                            <div class="tips">${m.tips}</div>
                        </div>`;
                    container.innerHTML += html;
                });
            } catch (error) {
                document.getElementById('app').innerHTML = "Erreur de chargement des donn√©es JSON.";
                console.error(error);
            }
        }
        loadData();

        // --- 2. GESTION DU CHATBOT IA ---
        const chatWindow = document.getElementById('chatWindow');
        const keyScreen = document.getElementById('apiKeyScreen');
        const interface = document.getElementById('chatInterface');
        const chatBody = document.getElementById('chatBody');
        let userApiKey = localStorage.getItem('vlad_api_key');

        function toggleChat() { chatWindow.style.display = chatWindow.style.display === 'flex' ? 'none' : 'flex'; checkKey(); }
        
        function checkKey() {
            if(userApiKey) { keyScreen.style.display = 'none'; interface.style.display = 'flex'; }
            else { keyScreen.style.display = 'flex'; interface.style.display = 'none'; }
        }

        function saveKey() {
            const input = document.getElementById('apiKeyInput').value.trim();
            if(input.length > 20 && input.startsWith('AIza')) { 
                localStorage.setItem('vlad_api_key', input); userApiKey = input; checkKey(); 
            } else { alert("Cl√© invalide. Elle doit commencer par 'AIza'."); }
        }

        function resetKey() {
            localStorage.removeItem('vlad_api_key');
            userApiKey = null;
            checkKey();
        }

        function handleEnter(e) { if(e.key === 'Enter') sendMessage(); }

        async function sendMessage() {
            const input = document.getElementById('userMsg');
            const text = input.value.trim();
            if(!text) return;
            addMessage(text, 'user');
            input.value = '';
            const loadingId = addMessage("...", 'bot');

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${userApiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: `Tu es Vladimir de LoL, expert Toplane. R√©ponds de fa√ßon concise et strat√©gique. Si la question n'est pas sur LoL, ignore. Question : ${text}` }] }] })
                });
                
                if (!response.ok) throw new Error(`Erreur HTTP ! statut: ${response.status}`);
                
                const data = await response.json();
                if (data.error) throw new Error(data.error.message);

                document.getElementById(loadingId).innerText = data.candidates[0].content.parts[0].text;
            } catch (error) {
                document.getElementById(loadingId).innerText = "Erreur API : V√©rifie ta cl√© ou les restrictions.";
                console.error("Erreur Gemini:", error);
            }
        }

        function addMessage(text, type) {
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            div.innerText = text;
            div.id = 'msg-' + Date.now();
            chatBody.appendChild(div);
            chatBody.scrollTop = chatBody.scrollHeight;
            return div.id;
        }
    </script>
</body>
</html>
